/*! BusBoardingMap 2016-05-03 */
"use strict";L.BusMainControl={},L.BusMainControl.legend=function(a,b,c){return new L.BusMainControl.ColourLegend(a,b,c)},L.BusMainControl.ColourLegend=L.Control.extend({options:{position:"topleft"},initialize:function(a,b,c){L.Util.setOptions(this,c),this.colourRange=b,this.capacityConfig=a,this.isFolded=!1},onAdd:function(a){this.container=L.DomUtil.create("div","busmain_legend"),this._FoldBtn=L.DomUtil.create("div","fold-btn"),this._FoldIcon=L.DomUtil.create("div","fa fa-caret-up fa-3x"),this._FoldBtn.setAttribute("id","fold"),this._FoldBtn.appendChild(this._FoldIcon),this._LegendMain=L.DomUtil.create("div","legend-main"),this._Title=L.DomUtil.create("div","legend-title",this._LegendMain),$(this._Title).text("Average Monthly Boarding"),this._LegendScale=L.DomUtil.create("div","legend-scale",this._LegendMain),this._LegendLabels=L.DomUtil.create("ul","legend-labels",this._LegendScale),this._LegendTexts=L.DomUtil.create("ul","legend-texts",this._LegendScale),this.container.appendChild(this._FoldBtn,this._LegendMain);for(var b=0;b<this.colourRange.length;b++){var c="<li><span style='background:"+this.colourRange[b].ColourCode+";'></span></li>";this._LegendLabels.appendChild(c)}for(var d=0;d<this.colourRange.length-1;d++){var e="<li>"+this.colourRange[d].MinCapacity+"</li>";this._LegendTexts.appendChild(e)}return L.DomEvent.on(this._FoldBtn,"click",function(a){L.DomEvent.stopPropagation(a),this.isFolded===!1?(this.isFolded=!0,this._FoldIcon.setAttribute("class","fa fa-caret-down fa-3x"),$(this._LegendMain).hide("normal")):(this.isFolded=!1,this._FoldIcon.setAttribute("class","fa fa-caret-up fa-3x"),$(this._LegendMain).show("normal"))},this),this.container},getCapacityAlias:function(a){return a>=this.capacityConfig.MaxRoof?a+"+":a===this.capacityConfig.MinRoof?"No Data":a}}),L.BusMainControl.dateview=function(a){return new L.BusMainControl.DateView(a)},L.BusMainControl.DateView=L.Control.extend({options:{position:"bottomleft"},initialize:function(a){L.Util.setOptions(this,a)},onAdd:function(a){return this.container=L.DomUtil.create("div","busmain_dateview"),this._MainText=L.DomUtil.create("h1","ViewText"),this.container.appendChild(this._MainText),this.container},ChangeValue:function(a){$(this._MainText).html(a.Year+"<br>"+a.Month)}}),L.BusMainControl.ridership=function(a,b){return new L.BusMainControl.RidershipView(a,b)},L.BusMainControl.RidershipView=L.Control.extend({options:{position:"topright"},initialize:function(a,b){L.Util.setOptions(this,b),this._TotalJson=a},onAdd:function(a){return this.container=L.DomUtil.create("div","busmain_ridershipView"),this._MainText=L.DomUtil.create("h1","ViewText"),this.container.appendChild(this._MainText),this.container},ChangeValue:function(a,b){void 0===b||null===b?$(this._MainText).text(this._TotalJson[a.Year][a.Month]):void 0===b[a.Year]?$(this._MainText).text("0"):$(this._MainText).text(b[a.Year][a.Month])}}),L.BusMainControl.routelegend=function(a){return new L.BusMainControl.RouteLegend(a)},L.BusMainControl.RouteLegend=L.Control.extend({options:{position:"bottomright"},initialize:function(a){L.Util.setOptions(this,a)},onAdd:function(a){return this.container=L.DomUtil.create("div","busmain_routeLegend"),this._MainText=L.DomUtil.create("h1","ViewText"),this.container.appendChild(this._MainText),this.container},ChangeText:function(a){void 0===a||null===a?$(this._MainText).text(""):$(this._MainText).text(a.name)}}),L.BusMainControl.slider=function(a,b){return new L.BusMainControl.DateSlider(a,b)},L.BusMainControl.DateSlider=L.Class.extend({initialize:function(a,b){this._controlJson=b,this._callback=a},AddWidget:function(){this.container=document.getElementById("slider_location"),this._MainSlider=L.DomUtil.create("input","slider_main"),this._MainSlider.setAttribute("type","range"),this._MainSlider.setAttribute("min","1"),this._MainSlider.setAttribute("max",(this._controlJson.To-this._controlJson.From+1)*this._controlJson.Ranges.length),this._MainSlider.setAttribute("value","0"),L.DomEvent.on(this._MainSlider,"change",function(a){this._callback(this._changeValue(this._MainSlider.value))},this),this.container.appendChild(this._MainSlider)},_changeValue:function(a){for(var b=this._controlJson.To-this._controlJson.From+2,c=1,d=1970,e=1;b>c;)if(this._controlJson.Ranges.length*c>=a&&a>=this._controlJson.Ranges.length*(c-1)){for(var f=this._controlJson.Ranges.length*(c-1)+1;f<this._controlJson.Ranges.length*c+1;f++)if(parseInt(a)===f){d=parseInt(this._controlJson.From)+(c-1),e=(c-1)*this._controlJson.Ranges.length;break}c++}else c++;var g={};return g.Year=d,g.Month=this._controlJson.Ranges[a-e-1],g}}),L.BusMainControl.sidebar=function(a,b,c){return new L.BusMainControl.routeSelector(a,b,c)},L.BusMainControl.routeSelector=L.Class.extend({initialize:function(a,b,c){this._controlJson=c,this._SideBar=L.DomUtil.get("sidebar"),this._MainContianer=L.DomUtil.get("main"),this._ClickBtnEvent=a,this._ClearEvent=b},AddWidget:function(){for(var a in this._controlJson)this._controlJson.hasOwnProperty(a)&&this._CreateCategorySections(this._controlJson[a],this._SideBar);this._AddClickEvent()},ChangeBtnState:function(a){$(a).toggleClass("route-btn-selected",!0)},RevertBtnState:function(){$(".route-btn").toggleClass("route-btn-selected",!1)},_CreateCategorySections:function(a,b){var c=L.DomUtil.create("section","sidebar-category",b);this._CreateCategoryBar(a.name,c);for(var d in a.members)a.members.hasOwnProperty(d)&&this._CreateSingleRouteButton(a.members[d],c)},_CreateCategoryBar:function(a,b){var c=L.DomUtil.create("section","category-bar",b);$(c).text(a)},_CreateSingleRouteButton:function(a,b){var c=L.DomUtil.create("section","route-btn",b);$(c).text(a.tags.ref),$(c).attr("id",a.tags["ref:querycode"])},_AddClickEvent:function(){L.DomEvent.on(this._SideBar,"click",function(a){this._ClickBtnEvent(a)},this),L.DomEvent.on(this._MainContianer,"contextmenu",function(a){L.DomEvent.preventDefault(a),this._ClearEvent()},this)}});