/*! BusBoardingMap 2016-04-14 */
"use strict";L.BusMainControl={},L.BusMainControl.legend=function(a,b,c){return new L.BusMainControl.ColourLegend(a,b,c)},L.BusMainControl.ColourLegend=L.Control.extend({options:{position:"bottomleft"},initialize:function(a,b,c){L.Util.setOptions(this,c),this.colourRange=b,this.capacityConfig=a},onAdd:function(a){this.container=L.DomUtil.create("div","busmain_legend"),this._Title="<div class='legend-title'>Average Monthly Boarding</div>",this._LegendScale=L.DomUtil.create("div","legend-scale"),this._LegendLabels=L.DomUtil.create("ul","legend-labels",this._LegendScale),this._LegendTexts=L.DomUtil.create("ul","legend-texts",this._LegendScale),$(this.container).append(this._Title,this._LegendScale);for(var b=0;b<this.colourRange.length;b++){var c="<li><span style='background:"+this.colourRange[b].ColourCode+";'></span></li>";$(this._LegendLabels).append(c)}for(var d=0;d<this.colourRange.length-1;d++){var e="<li>"+this.colourRange[d].MinCapacity+"</li>";$(this._LegendTexts).append(e)}return this.container},getCapacityAlias:function(a){return a>=this.capacityConfig.MaxRoof?a+"+":a===this.capacityConfig.MinRoof?"No Data":a}}),L.BusMainControl.dateview=function(a){return new L.BusMainControl.DateView(a)},L.BusMainControl.DateView=L.Control.extend({options:{position:"topleft"},initialize:function(a){L.Util.setOptions(this,a)},onAdd:function(a){return this.container=L.DomUtil.create("div","busmain_dateview"),this._MainText=L.DomUtil.create("h1","dateViewText"),$(this.container).append(this._MainText),this.container},ChangeValue:function(a){$(this._MainText).html(a.Year+"<br>"+a.Month)}}),L.BusMainControl.ridership=function(a,b){return new L.BusMainControl.RidershipView(a,b)},L.BusMainControl.RidershipView=L.Control.extend({options:{position:"topright"},initialize:function(a,b){L.Util.setOptions(this,b),this._TotalJson=a},onAdd:function(a){return this.container=L.DomUtil.create("div","busmain_ridershipView"),this._MainText=L.DomUtil.create("h1","ridershipViewText"),$(this.container).append(this._MainText),this.container},ChangeValue:function(a){$(this._MainText).text(this._TotalJson[a.Year][a.Month])}}),L.BusMainControl.slider=function(a,b){return new L.BusMainControl.DateSlider(a,b)},L.BusMainControl.DateSlider=L.Class.extend({initialize:function(a,b){this._controlJson=b,this._callback=a},AddWidget:function(){this.container=$("#slider_location"),this._MainSlider=L.DomUtil.create("input","slider_main"),$(this._MainSlider).attr("type","range"),$(this._MainSlider).attr("min","1"),$(this._MainSlider).attr("max",(this._controlJson.To-this._controlJson.From+1)*this._controlJson.Ranges.length),$(this._MainSlider).attr("value","0"),L.DomEvent.on(this._MainSlider,"change",function(a){this._callback(this._changeValue(this._MainSlider.value))},this),$(this.container).append(this._MainSlider)},_changeValue:function(a){for(var b=this._controlJson.To-this._controlJson.From+2,c=1,d=1970,e=1;b>c;)if(this._controlJson.Ranges.length*c>=a&&a>=this._controlJson.Ranges.length*(c-1)){for(var f=this._controlJson.Ranges.length*(c-1)+1;f<this._controlJson.Ranges.length*c+1;f++)if(parseInt(a)===f){d=parseInt(this._controlJson.From)+(c-1),e=(c-1)*this._controlJson.Ranges.length;break}c++}else c++;var g={};return g.Year=d,g.Month=this._controlJson.Ranges[a-e-1],g}}),L.BusMainControl.sidebar=function(a){return new L.BusMainControl.routeSelector(a)},L.BusMainControl.routeSelector=L.Class.extend({initialize:function(a){this._controlJson=a,this._SideBar=L.DomUtil.get("sidebar")},AddWidget:function(){for(var a in this._controlJson)this._controlJson.hasOwnProperty(a)&&this._CreateCategorySections(this._controlJson[a],this._SideBar)},_CreateCategorySections:function(a,b){var c=L.DomUtil.create("section","sidebar-category",b),d=this;this._CreateCategoryBar(a.name,c);for(var e in a.members)a.members.hasOwnProperty(e)&&d._CreateSingleRouteButton(a.members[e],c)},_CreateCategoryBar:function(a,b){var c=L.DomUtil.create("section","category-bar",b),d="<p>"+a+"</p>";$(c).append(d)},_CreateSingleRouteButton:function(a,b){var c=L.DomUtil.create("section","route-btn",b),d="<p>"+a.tags.ref+"</p>";$(c).append(d)}});